4월의 낙원호 회고
===

- 개발: 3월 5일 ~
- 서비스: 4월 13일 ~ 4월 22일

지인의 부탁으로 만들게 되었다. 원래 5월 개장 예정이었는데, 5월엔 바쁠 것 같아서 + 내부 사정을 이유로 4월 개장으로 앞당겨졌다.

처음 요구는 '30명 정도의 고정 인원이 10일 가량 즐길 미니게임 + 결과 집계하기만 편하게 해달라' 였는데, 욕심이 나서 사용자 인증도 달고, 백오피스도 만들기로 했다.

협업 경험이 많지 않았던 터라, 커뮤니케이션에 어려움을 많이 겪었다. 주최자 중 한 명과 소통할 수 있었고, 내부적으로 회의를 거친 후 일감을 통보 받는 식이라 많이 답답했다. 런칭 일주일 전에 누락된 사항을 전달 받기도 했다. 나중에 알게 되었는데, 부탁하는 입장이라 미안했는지 업무를 줄여줄려고 자체적으로 일감을 쳐내고 있었다. 그렇게 간단한 업무는 사라지고 복잡한 업무만 받게되는 기현상을 일부 겪기도 했다. 기획 단계부터 관여했어야 더 효율적으로 일할 수 있을 것 같았다는 아쉬움이 남는다.

서비스는 SvelteKit(Svelte 5)과 EdgeDB를 사용했다. Svelte 5는 개인 프로젝트로 잘 활용하고 있었고, Svelte 4보다 DX나 성능면에서 월등했고, EdgeDB는 [비즈니스 로직을 스키마에 녹였다는 fiori.ai의 글](https://www.edgedb.com/blog/why-putting-logic-in-your-database-is-pretty-great-with-fiori-ai)을 감명깊게 읽고 도입하였다.

의외로 SvelteKit을 지원하는 툴은 많았다. Storybook도 Sentry도. 필요해서 찾아보면 대부분 SvelteKit을 지원했다. Svelte 4라는 점만 빼면. 결국 Storybook에서 필요한 기능만 간단히 구현한 [Stylebook을 만들거나](https://x.com/tnRaro/status/1774110029114909124), Sentry for JavaScript를 쓰는 등의 우회가 필요했다.

EdgeDB는... 문제가 정말 많았다. 메모리가 최소 1기가 이상 필요하고, 지원하는 클라우드가 없다보니(공식 클라우드는 비용이 너무 비쌌다) 서버가 강제되었다. J4105가 들어간 개인 서버에 올렸을 때, 개발 서버보다 8배 이상 느린 응답을 만들었다. 이를 가엾게 여기신 초코 님께서 N100 서버의 접근 권한을 하사하셨다(감사합니다).

하지만, 서비스 첫 날에 요청이 점점 느려지더니 최대 20초 뒤에 트랜잭션 실패하는 일이 발생했다. EdgeQL이 복잡한 SQL도 직관적으로 짤 수 있는 장점이 있지만, 그만큼 눈에 보이지 않는 비용을 찾기 어려운 단점이 있었다. 인증에 사용되는 `ext::auth::ClientTokenIdentity`를 쿼리하는 게 정말 느린데, 하나의 쿼리 안에서 이를 여러번 호출하는게 원인이었다. 문제를 해결 후 평균 2초가 걸리던 요청이 평균 54ms가 걸리게 되었다.

스키마 migration이 서버가 켜져야 가능한데, migration 도중 문제가 발생해 서버가 꺼져서 한 시간 반동안 연장 점검을 하기도 했다. 서로 의존성을 가지는 변경사항을 EdgeDB가 감지하지 못해서 일어나는 게 원인이었고, 순서에 맞게 수동으로 나눠서 해결했다.